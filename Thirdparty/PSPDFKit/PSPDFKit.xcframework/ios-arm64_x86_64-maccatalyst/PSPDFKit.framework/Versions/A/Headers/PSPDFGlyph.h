//
//  Copyright Â© 2012-2020 PSPDFKit GmbH. All rights reserved.
//
//  THIS SOURCE CODE AND ANY ACCOMPANYING DOCUMENTATION ARE PROTECTED BY INTERNATIONAL COPYRIGHT LAW
//  AND MAY NOT BE RESOLD OR REDISTRIBUTED. USAGE IS BOUND TO THE PSPDFKIT LICENSE AGREEMENT.
//  UNAUTHORIZED REPRODUCTION OR DISTRIBUTION IS SUBJECT TO CIVIL AND CRIMINAL PENALTIES.
//  This notice may not be removed from this file.
//

#import <PSPDFKit/PSPDFEnvironment.h>
#import <PSPDFKit/PSPDFGlyphRange.h>

NS_ASSUME_NONNULL_BEGIN

/// Represents a single character (glyph, quad) on the PDF page.
///
/// @note Glyphs are created from the PDF contents and not meant to be created manually.
PSPDF_CLASS_SUBCLASSING_RESTRICTED_SWIFT(Glyph)
@interface PSPDFGlyph : NSObject<NSCopying, NSSecureCoding>

PSPDF_EMPTY_INIT_UNAVAILABLE

/// Frame of the glyph, normalized to take the font of the text block it is in into account.
@property (nonatomic, readonly) CGRect frame;

/// Character content (usually a single character).
@property (nonatomic, copy, readonly) NSString *content;

/// Checks if after this glyph is a newline character.
@property (nonatomic, readonly) BOOL lineBreaker;

/// Checks if glyph is a word boundary (space, parenthesis, control character).
@property (nonatomic, readonly, getter=isWordBreaker) BOOL wordBreaker;

/// Returns YES if glyph is end of a word or line.
@property (nonatomic, readonly) BOOL isWordOrLineBreaker;

/// Returns `true` if the receiver is an autogenerated filler.
@property (nonatomic, readonly, getter=isGenerated) BOOL generated;

/// Index of the glyph on the page, and in `PSPDFTextParser.glyphs`. All glyphs from the same page are guaranteed
/// to have unique values for this property.
@property (nonatomic, readonly) NSInteger indexOnPage;

@end

/// Converts an array of glyphs to a string.
PSPDF_EXPORT NSString *PSPDFStringFromGlyphs(NSArray<PSPDFGlyph *> *_Nullable glyphs);

/// Returns the bounding box that includes all glyphs.
///
/// @return Rect encompassing all glyphs or CGRectZero if glyphs is empty.
PSPDF_EXPORT CGRect PSPDFBoundingBoxFromGlyphs(NSArray<PSPDFGlyph *> *_Nullable glyphs);

/// Global helper to convert glyphs to rects.
PSPDF_EXPORT NSArray<NSValue *> *PSPDFRectsFromGlyphs(NSArray<PSPDFGlyph *> *_Nullable glyphs, CGRect *boundingBox);

/// Returns an NSRange representing the glyphs in `glyphs`, assuming they are in ascending order of their `indexOnPage`.
/// If `glyphs` is not sorted, this method this method will return a wrong result. `PSPDFInvalidGlyphRange` is returned an empty array,
/// or if the last glyph has an indexOnPage that is prior to the first one.
PSPDF_EXPORT NSRange PSPDFRangeFromGlyphs(NSArray<PSPDFGlyph *> *glyphs);

NS_ASSUME_NONNULL_END
